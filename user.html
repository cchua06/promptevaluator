<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GenAI Prompt Feedback POC</title>
    <!-- Tailwind via CDN for quick styling (can be removed/replaced later) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel so we can write JSX in this single file. Swap out for a build step (Vite/Webpack) later. -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
      body { @apply bg-gray-50 text-gray-800; font-family: 'Inter', sans-serif; }
      textarea { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
      .fade-in { animation: fade-in 0.3s ease-out; }
      @keyframes fade-in { from { opacity:0; transform: translateY(4px);} to { opacity:1; transform: translateY(0);} }
      h1, h2, h3, h4, h5, h6, .font-bold, .font-semibold, .text-3xl, .text-4xl, .font-bold, .font-semibold {
        font-family: 'Inter', sans-serif;
        font-weight: 600;
      }
    </style>
  </head>
  <body class="min-h-screen flex flex-col">
    <div id="root" class="flex-1"></div>

    <script type="text/babel">
      // ---------------------------
      // Helpers
      // ---------------------------
      function mockEvaluatePrompt(prompt) {
        const length           = prompt.trim().split(/\s+/).length;
        const hasRole          = /you are|act as|role:/i.test(prompt);
        const hasOutputFormat  = /format|return|respond with|output/i.test(prompt);
        const hasConstraints   = /must|should|limit|do not/i.test(prompt);

        const notes = [];
        if (length < 30)        notes.push("Prompt is quite short; consider adding context and desired outcome.");
        if (!hasRole)           notes.push("Define the assistant's role (e.g., 'You are an expert data analyst...').");
        if (!hasOutputFormat)   notes.push("Specify the desired output format or structure.");
        if (!hasConstraints)    notes.push("Add constraints or evaluation criteria to guide the response.");
        if (notes.length === 0) notes.push("Looks solid! You covered role, structure, and constraints.");

        return { notes: notes.join(" ") };
      }

      const isBlank = (s) => !s || s.trim().length === 0;
      const mockLLMOutput = (p) => {
        const snippet = p.length > 400 ? p.slice(0, 400) + "..." : p;
        return `Dummy model output (for demo only)\n\n${snippet}\n\n[This is placeholder text. Replace with real model response later.]`;
      };
      const sendToEvaluator = ({ prompt }) => new Promise(r => setTimeout(() => r({ ...mockEvaluatePrompt(prompt), dummyOutput: mockLLMOutput(prompt) }), 600));

      // ---------------------------
      // React Component
      // ---------------------------
      function App() {
        const [firstName, setFirstName] = React.useState("");
        const [lastName,  setLastName]  = React.useState("");
        const [prompt,    setPrompt]    = React.useState("");
        const [records,   setRecords]   = React.useState([]);
        const [isSubmitting, setIsSubmitting] = React.useState(false);
        const [lastEval,  setLastEval]  = React.useState(null);
        const [lastDummy, setLastDummy] = React.useState(null);

        React.useEffect(() => localStorage.setItem("prompt_records_v1", JSON.stringify(records)), [records]);

        const handleSubmit = async (e) => {
          e.preventDefault();
          if (isBlank(firstName) || isBlank(lastName)) return alert("First and last name cannot be blank.");
          if (!prompt.trim()) return;
          setIsSubmitting(true);

          const { notes, dummyOutput } = await sendToEvaluator({ prompt });
          const ts = new Date().toISOString();
          const newRec = { id: crypto.randomUUID(), timestamp: ts, firstName: firstName.trim(), lastName: lastName.trim(), prompt, notes, dummyOutput };

          setRecords(prev => [newRec, ...prev]);
          setLastEval({ notes, ts });
          setLastDummy({ text: dummyOutput, ts });
          setPrompt(""); setFirstName(""); setLastName("");
          setIsSubmitting(false);
        };

        return (
          <div className="w-full pt-20 pb-12 px-4">
            {/* Row with symmetric logo + main + spacer */}
            <div className="flex items-start max-w-7xl mx-auto">
              {/* Left logo column */}
              <div className="flex-shrink-0 w-[160px] mr-8 flex justify-center">
                <img src="./resources/tm_logo.jpg" alt="Thinking Machines Logo" className="h-[160px] w-auto" />
              </div>

              {/* Main column wider */}
              <div className="flex-1 max-w-5xl mx-auto">
                {/* Header */}
                <header className="mb-6 text-left">
                  <h1 className="text-4xl font-bold leading-tight mb-2">Thinking Machines Prompt Evaluator</h1>
                  <span className="text-sm text-gray-500 hidden sm:inline">Beta testing</span>
                  <p className="text-gray-600 mt-2">Quickly score &amp; review prompts during enablement sessions.</p>
                </header>

                {/* Form */}
                <section className="mb-10">
                  <form onSubmit={handleSubmit} className="bg-white shadow rounded-lg p-10 space-y-8">
                    <div>
                      <label className="block text-sm font-medium mb-1">First Name <span className="text-red-600">*</span></label>
                      <input type="text" className="w-full border rounded px-5 py-3" value={firstName} onChange={e => setFirstName(e.target.value)} placeholder="e.g., Alice" required />
                    </div>
                    <div>
                      <label className="block text-sm font-medium mb-1">Last Name <span className="text-red-600">*</span></label>
                      <input type="text" className="w-full border rounded px-5 py-3" value={lastName} onChange={e => setLastName(e.target.value)} placeholder="e.g., Garcia" required />
                    </div>
                    <div>
                      <label className="block text-sm font-medium mb-1">Prompt <span className="text-red-600">*</span></label>
                      <textarea className="w-full border rounded px-5 py-3 h-40" value={prompt} onChange={e => setPrompt(e.target.value)} placeholder="Paste your prompt here to check against prompt writing best practices" required />
                    </div>
                    <div className="flex items-center gap-4">
                      <button type="submit" disabled={isSubmitting || !prompt.trim()} className={`px-7 py-3 rounded text-white ${isSubmitting || !prompt.trim() ? 'bg-gray-400 cursor-not-allowed' : 'bg-blue-600 hover:bg-blue-700'}`}>{isSubmitting ? 'Evaluating…' : 'Submit'}</button>
                      <span className="ml-auto text-sm text-gray-500 hidden sm:inline">Stored locally for admin view</span>
                    </div>
                  </form>

                  {/* Feedback */}
                  {lastEval && (
                    <div className="mt-10 bg-white border-l-4 border-blue-500 shadow rounded-lg p-8 fade-in">
                      <h3 className="font-semibold mb-2 text-base">Evaluation Feedback <span className="text-gray-500">({new Date(lastEval.ts).toLocaleString()})</span></h3>
                      <p className="whitespace-pre-wrap break-words text-sm">{lastEval.notes}</p>
                    </div>
                  )}

                  {lastDummy && (
                    <div className="mt-10 bg-slate-50 border rounded-lg p-8 fade-in">
                      <h3 className="font-semibold mb-2 text-base">Dummy Model Output <span className="text-gray-500">({new Date(lastDummy.ts).toLocaleString()})</span></h3>
                      <pre className="whitespace-pre-wrap break-words text-xs sm:text-sm">{lastDummy.text}</pre>
                    </div>
                  )}
                </section>

                <footer className="mt-20 text-xs text-gray-400 text-center">
                  <p>POC only – no real LLM calls. Replace mock functions with API calls in production.</p>
                </footer>
              </div>

              {/* Right spacer column matching logo width */}
              <div className="flex-shrink-0 w-[160px] ml-8"></div>
            </div>
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
  </body>
</html>
